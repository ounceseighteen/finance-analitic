<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .file-input-wrapper {
            position: relative;
            margin-bottom: 15px;
        }
        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .remove-file {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #dc3545;
            font-size: 20px;
            cursor: pointer;
            display: none;
        }
        .file-name {
            margin-top: 5px;
            color: #666;
            font-size: 14px;
        }
        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
        .instructions h4 {
            margin-top: 0;
            color: #007bff;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        .action-card {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .action-card h3 {
            margin-top: 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .action-card h3 i {
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h1>

        <div class="nav-links">
            <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="{{ url_for('add_transaction') }}">–î–æ–±–∞–≤–∏—Ç—å</a>
            <a href="{{ url_for('history') }}">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="{{ url_for('import_export') }}" class="active">–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</a>
            <span style="margin-left: auto; color: #333;">
                –ü—Ä–∏–≤–µ—Ç, {{ session.username }}!
            </span>
            <a href="{{ url_for('logout') }}" style="color: #dc3545;">–í—ã–π—Ç–∏</a>
        </div>

        {% if success %}
        <div class="success-message">
            <h3>‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h3>
            <p>–î–æ–±–∞–≤–ª–µ–Ω–æ <strong>{{ count }}</strong> –æ–ø–µ—Ä–∞—Ü–∏–π.</p>
            {% if errors %}
            <p>–û—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:</p>
            <ul>
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endif %}

        {% if error %}
        <div class="error-message">
            <h3>‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞</h3>
            <p>{{ error }}</p>
        </div>
        {% endif %}

        <div class="action-buttons">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ -->
            <div class="action-card">
                <h3>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏</p>

                <div class="instructions">
                    <h4>üìã –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞</h4>
                    <ul>
                        <li><strong>–î–∞—Ç–∞</strong> - –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä: 15.01.2024)</li>
                        <li><strong>–¢–∏–ø</strong> - "–î–æ—Ö–æ–¥" –∏–ª–∏ "–†–∞—Å—Ö–æ–¥"</li>
                        <li><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</strong> - –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏</li>
                        <li><strong>–°—É–º–º–∞</strong> - —á–∏—Å–ª–æ (–¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω—É—Å)</li>
                        <li><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong> - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</li>
                    </ul>
                </div>

                <form method="POST" enctype="multipart/form-data" id="importForm">
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" name="file" accept=".xlsx,.xls" required>
                            <button type="button" class="remove-file" id="removeFileBtn" title="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª">√ó</button>
                        </div>
                        <div class="file-name" id="fileName"></div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn-primary">üì• –ù–∞—á–∞—Ç—å –∏–º–ø–æ—Ä—Ç</button>
                        <a href="{{ url_for('download_template') }}" class="btn-secondary">üìã –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</a>
                    </div>
                </form>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
            <div class="action-card">
                <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <p>–°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ –≤–∞—à–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ Excel —Ñ–∞–π–ª</p>

                <div class="instructions">
                    <h4>üìä –ß—Ç–æ –±—É–¥–µ—Ç –≤ —Ñ–∞–π–ª–µ:</h4>
                    <ul>
                        <li>–õ–∏—Å—Ç "–û–ø–µ—Ä–∞—Ü–∏–∏" - –≤—Å–µ –≤–∞—à–∏ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</li>
                        <li>–õ–∏—Å—Ç "–°–≤–æ–¥–∫–∞" - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</li>
                        <li>–î–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì</li>
                        <li>–¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ</li>
                        <li>–°—É–º–º—ã —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å –º–∏–Ω—É—Å–æ–º</li>
                    </ul>
                </div>

                <div class="button-group">
                    <a href="{{ url_for('export_excel') }}" class="btn-primary">üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</a>
                    <a href="{{ url_for('history') }}" class="btn-secondary">üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fileName = this.files[0] ? this.files[0].name : '';
            const fileNameDisplay = document.getElementById('fileName');
            const removeBtn = document.getElementById('removeFileBtn');

            if (fileName) {
                fileNameDisplay.textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${fileName}`;
                removeBtn.style.display = 'block';
            } else {
                fileNameDisplay.textContent = '';
                removeBtn.style.display = 'none';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        document.getElementById('removeFileBtn').addEventListener('click', function() {
            const fileInput = document.getElementById('fileInput');
            const fileNameDisplay = document.getElementById('fileName');
            const removeBtn = document.getElementById('removeFileBtn');

            fileInput.value = '';
            fileNameDisplay.textContent = '';
            removeBtn.style.display = 'none';
        });

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞
        document.getElementById('importForm').addEventListener('submit', function(e) {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return false;
            }

            return confirm('–ù–∞—á–∞—Ç—å –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞?');
        });
    </script>
</body>
</html>